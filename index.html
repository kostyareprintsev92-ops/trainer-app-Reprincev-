<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–µ—Ä–∞</title>
  <style>
    :root { --bg:#f6f6f6; --card:#fff; --muted:#7d7d7d; --text:#111; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{max-width:900px;margin:20px auto;padding:0 16px}
    .bar{position:sticky;top:0;z-index:10;background:rgba(255,255,255,.9);backdrop-filter:saturate(150%) blur(6px);border-bottom:1px solid #eaeaea}
    .bar-in{max-width:900px;margin:0 auto;padding:12px 16px}
    h1{font-size:20px;margin:0;font-weight:700}
    .card{background:var(--card);border:1px solid #eaeaea;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.03)}
    .ttl{font-weight:700;margin-bottom:8px}
    .in{padding:10px 12px;border:1px solid #d7d7d7;border-radius:10px;width:100%;font-size:16px;background:#fff}
    .row{display:grid;gap:12px}
    @media(min-width:700px){ .row{grid-template-columns:1fr 1fr} }
    .btn{padding:12px 16px;border-radius:10px;border:0;font-weight:700;font-size:16px}
    .btn.primary{background:#111;color:#fff}
    .btn:disabled{opacity:.6}
    .muted{color:var(--muted);font-size:14px}
    #msg{display:none;padding:10px;border-radius:8px;margin-top:12px}
    #msg.ok{display:block;background:#e9f7ef;color:#0a7a3f;border:1px solid #bde5c8}
    #msg.err{display:block;background:#fdecea;color:#9f3a38;border:1px solid #f5c6cb}
    footer{margin:32px 0;color:#888;text-align:center;font-size:14px}
  </style>
</head>
<body>
  <div class="bar">
    <div class="bar-in">
      <h1>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—Ä–µ–Ω–µ—Ä–∞</h1>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="ttl">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</div>
      <p class="muted">–û—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —è –ø–æ–¥—Ç–≤–µ—Ä–∂—É –∑–∞–ø–∏—Å—å –∏ —Å–≤—è–∂—É—Å—å —Å –≤–∞–º–∏.</p>

      <form id="bookingForm">
        <div class="row">
          <input id="name" class="in" placeholder="–ò–º—è" autocomplete="name" required />
          <input id="phone" class="in" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" inputmode="tel" autocomplete="tel" required />
        </div>

        <div class="row" style="margin-top:12px">
          <input id="date" class="in" type="date" required />
          <select id="time" class="in" required>
            <option value="" disabled selected>–í—Ä–µ–º—è</option>
            <option>08:00</option><option>09:00</option><option>10:00</option>
            <option>11:00</option><option>12:00</option><option>13:00</option>
            <option>14:00</option><option>15:00</option><option>16:00</option>
            <option>17:00</option><option>18:00</option><option>19:00</option>
            <option>20:00</option>
          </select>
        </div>

        <textarea id="note" class="in" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" style="margin-top:12px;height:90px"></textarea>

        <button id="submitBtn" class="btn primary" type="submit" style="margin-top:14px">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è</button>
        <div id="msg"></div>
      </form>

      <p class="muted" style="margin-top:14px">–ó–∞—è–≤–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Cloud Firestore –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Telegram.</p>
    </div>

    <footer>–°–¥–µ–ª–∞–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–ø–∏—Å–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</footer>
  </div>

  <!-- Firebase + Firestore + Telegram -->
  <script type="module">
    // 1) Firebase SDK (–º–æ–¥—É–ª—å–Ω—ã–π CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 2) –¢–í–û–Ø –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase ‚Äî –í–°–¢–ê–í–¨ –°–í–û–Æ
    // –ó–∞–π–¥–∏ –≤ Firebase ‚Üí Project settings ‚Üí Your apps ‚Üí Web ‚Üí SDK setup and configuration
    // –∏ –∑–∞–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç –Ω–∏–∂–µ –Ω–∞ —Å–≤–æ–π firebaseConfig.
    const firebaseConfig = {
      apiKey: "AIzaSyA3XwM-qceM1_uMuK7NpTa7RKQyAyQw1Ws",
      authDomain: "reprincev-b73c7.firebaseapp.com",
      projectId: "reprincev-b73c7",
      storageBucket: "reprincev-b73c7.firebasestorage.app",
      messagingSenderId: "616952094737",
      appId: "1:616952094737:web:82f22ef07d9f13309911b0",
      measurementId: "G-8WFHS344GZ"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    // 3) –ù–∞—Å—Ç—Ä–æ–π Telegram. –ó–ê–ú–ï–ù–ò –ü–õ–ï–ô–°–•–û–õ–î–ï–†–´.
    // –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω —É @BotFather –∏ —Å–≤–æ–π chat_id (—Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ).
    const TG_BOT_TOKEN = "PASTE_YOUR_BOT_TOKEN_HERE";   // –Ω–∞–ø—Ä. 1234567890:AA...
    const TG_CHAT_ID   = "PASTE_YOUR_CHAT_ID_HERE";     // –Ω–∞–ø—Ä. 123456789

    // –£—Ç–∏–ª–∏—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    const clean = s => (s || "").toString().trim();
    const $ = id => document.getElementById(id);

    // –°—Ç–∞–≤–∏–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const today = new Date();
    $("date").value = today.toISOString().slice(0,10);

    async function sendToTelegram(text) {
      if (!TG_BOT_TOKEN || !TG_CHAT_ID) return; // —Ç–∏—Ö–æ –≤—ã—Ö–æ–¥–∏–º, –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
      const url = `https://api.telegram.org/bot${TG_BOT_TOKEN}/sendMessage`;
      await fetch(url, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify({
          chat_id: TG_CHAT_ID,
          text,
          parse_mode: "HTML",
          disable_web_page_preview: true
        })
      });
    }

    function showMsg(ok, text){
      const box = $("msg");
      box.className = ok ? "ok" : "err";
      box.textContent = text;
    }

    $("bookingForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const btn = $("submitBtn");
      btn.disabled = true; showMsg(true, "–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞—è–≤–∫—É‚Ä¶");

      try {
        const name = clean($("name").value);
        const phone = clean($("phone").value);
        const date = $("date").value;
        const time = $("time").value;
        const note = clean($("note").value);

        if (!name || !phone || !date || !time) {
          showMsg(false, "–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è.");
          btn.disabled = false; return;
        }

        // 4) –ü–∏—à–µ–º –≤ Firestore (–∫–æ–ª–ª–µ–∫—Ü–∏—è Trainings)
        await addDoc(collection(db, "Trainings"), {
          name, phone, date, time, note,
          createdAt: serverTimestamp(),
          status: "new"
        });

        // 5) –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–±–µ –≤ Telegram
        const tgText =
          `üÜï <b>–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</b>\n` +
          `üë§ –ò–º—è: ${name}\n` +
          `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n` +
          `üìÖ –î–∞—Ç–∞/–≤—Ä–µ–º—è: ${date} ${time}\n` +
          (note ? `üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${note}\n` : ``) +
          `‚è± –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: ${new Date().toLocaleString("ru-RU")}`;

        await sendToTelegram(tgText);

        showMsg(true, "–ì–æ—Ç–æ–≤–æ! –Ø —Å–≤—è–∂—É—Å—å —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.");
        $("bookingForm").reset();
        $("date").value = today.toISOString().slice(0,10);
      } catch (err) {
        console.error(err);
        showMsg(false, "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
